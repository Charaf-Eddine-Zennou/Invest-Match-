<!-- Section Investissements -->
<div *ngIf="activeTab === 'investissements'" class="investissements-section">
  <h2 class="heading">Mes Investissements</h2>
</div>

<!-- Section Top 5 Entreprises -->
<div *ngIf="activeTab === 'top5'">
  <h2 class="heading">Top 5 entreprises recommandées</h2>

  <!-- Barre de recherche -->
  <div class="search-bar">
    <input 
      type="text" 
      placeholder="Rechercher une entreprise..." 
      [(ngModel)]="searchTerm"
      class="search-input"
    />
    <button (click)="searchEntreprises()" class="search-btn">
      <i-lucide name="Search"></i-lucide>
    </button>

    <div class="notification-wrapper">
      
  <button (click)="toggleNotifications()" class="notif-btn">
    <lucide-icon name="Bell"></lucide-icon>
  </button>

  <div *ngIf="showNotifications" class="notif-panel">
    <h3>Notifications</h3>
    <p>Aucune notification</p>
  </div>
</div>





  </div>

  <!-- Liste filtrée des entreprises -->
  <div *ngFor="let entreprise of filteredEntreprises; let i = index" class="entreprise-container">

    <div class="entreprise-card">
      <h3 class="entreprise-nom">1:{{ entreprise.nom }} </h3>
      <p class="entreprise-secteur">Secteur : {{ entreprise.secteur }}</p>
    
    <video
  *ngIf="entreprise.videoUrl"
  [src]="'http://localhost:3000/companies/video/' + entreprise.videoUrl.split('/').pop()"
  muted
  loop
  playsinline
  controls
  class="entreprise-video">
</video>
      
      <div class="btn-group">
        <button (click)="like(entreprise)" [class.active]="entreprise.liked" class="action-btn">
          <i-lucide name="ThumbsUp"></i-lucide> Like
        </button>
        <button (click)="dislike(entreprise)" [class.active]="entreprise.disliked" class="action-btn">
          <i-lucide name="ThumbsDown"></i-lucide> Dislike
        </button>
        <button (click)="save(entreprise)" [class.active]="entreprise.saved" class="action-btn">
          <i-lucide name="Save"></i-lucide> Save
        </button>
        <button (click)="openComments(entreprise)" class="action-btn">
          <i-lucide name="MessageCircle"></i-lucide> Comments
        </button>
      </div>
    </div>











    <div *ngIf="selectedCompany?.entreprise_id === entreprise.entreprise_id" class="comments-section">
      <h4>Commentaires pour {{ selectedCompany.nom || selectedCompany.name }}</h4>

      <div *ngIf="comments.length === 0">
        <em>Aucun commentaire pour le moment</em>
      </div>

     <div *ngFor="let comment of comments" class="comment-item">
  <div class="comment-left">
    <strong>{{ comment.user?.name || 'Utilisateur inconnu' }}</strong>
    <span class="comment-text"> {{ comment.content }} </span>
  </div>

  <div class="comment-right">
    <span class="comment-like-count">{{ comment.likeCount || 0 }}</span>
    <button (click)="likeComment(comment)" class="comment-like-btn">
      <i-lucide 
        [name]="comment.likedByCurrentUser ? 'HeartFill' : 'Heart'" 
        class="comment-heart-icon"
        [class.liked]="comment.likedByCurrentUser">
      </i-lucide>
    </button>
  </div>
</div>





      <div class="new-comment">
        <input type="text" [(ngModel)]="newComment" placeholder="Écrire un commentaire...">
        <button (click)="addComment()">Envoyer</button>
      </div>
    </div>
  </div>
</div>

<!-- Section Profil -->
<div *ngIf="activeTab === 'profil'" class="profil-container">
  <div class="profil-header">
    <div class="avatar"></div>
    <div class="profil-info">
      <h3>{{ user?.nom }}</h3>
      <p>{{ user?.email }}</p>
    </div>
  </div>
  <div class="profil-actions">
    <button class="btn-modifier" (click)="modifierProfil()">Modifier le profil</button>
  </div>
  <div class="profil-menu">
    <button (click)="setProfilSection('investissements')">
      <lucide-icon name="DollarSign"></lucide-icon>
    </button>
    <button (click)="setProfilSection('favoris')">
      <lucide-icon name="heart"></lucide-icon> 
    </button>
    <button (click)="setProfilSection('statistiques')">
      <lucide-icon name="bar-chart"></lucide-icon> 
    </button>
    <button (click)="setProfilSection('publications')">
      <lucide-icon name="file-text"></lucide-icon> 
    </button>
  </div>
  <div class="profil-section">
    <ng-container [ngSwitch]="profilSection">
      <div *ngSwitchCase="'investissements'"><h2>Mes investissements</h2></div>
      <div *ngSwitchCase="'favoris'"><h2>Mes favoris</h2></div>
      <div *ngSwitchCase="'statistiques'"><h2>Statistiques</h2></div>
      <div *ngSwitchCase="'publications'"><h2>Mes publications</h2></div>
    </ng-container>
  </div>
</div>
<!-- Section Messages -->
<div *ngIf="activeTab === TabEnum.Messages" class="messages-section">
  <h2>Messagerie</h2>

  <!-- Barre de recherche toujours visible -->
  <div class="search-bar">
    <input
      type="text"
      [(ngModel)]="searchQuery"
      (input)="searchUsers()"
      placeholder="Rechercher un utilisateur par nom..."
      class="search-input"
    />
  </div>

  <!-- Résultats de recherche si on tape quelque chose -->
  <div *ngIf="searchQuery && searchResults.length > 0" class="search-results">
    <div class="user-item" *ngFor="let u of searchResults">
      <div class="user-meta">
        <div class="user-name">{{ u.name }}</div>
        <div class="user-email" *ngIf="u.email">{{ u.email }}</div>
      </div>
      <button class="message-btn" (click)="goToMessages(u)">
        <lucide-icon name="MessageCircle"></lucide-icon>
        Message
      </button>
    </div>
  </div>

  <!-- Aucun résultat trouvé -->
  <div *ngIf="searchQuery && searchResults.length === 0" class="no-result">
    Aucun utilisateur trouvé.
  </div>

  <!-- Liste des conversations existantes (si pas de recherche en cours) -->
  <div *ngIf="!searchQuery && messages.length > 0" class="conversations-list">
    <div class="user-item" *ngFor="let user of messages">
      <div class="user-meta">
        <div class="user-name">{{ user.name || 'Utilisateur inconnu' }}</div>
      </div>
      <button class="message-btn" (click)="goToMessages(user)">
        <lucide-icon name="MessageCircle"></lucide-icon>
        Ouvrir
      </button>
    </div>
  </div>

  <!-- Aucun message existant et pas de recherche -->
  <div *ngIf="!searchQuery && messages.length === 0">
    <p class="empty">Aucune conversation pour l’instant.</p>
  </div>
</div>



<!-- Barre de navigation (EN DEHORS de tout *ngIf) -->
<div class="bottom-nav"> 
  <button [class.active]="activeTab===TabEnum.Investissements" (click)="setTab(TabEnum.Investissements)">
    <lucide-icon name="Home"></lucide-icon>
  </button> 
  <button [class.active]="activeTab===TabEnum.Top5" (click)="setTab(TabEnum.Top5)">
    <lucide-icon name="Lightbulb"></lucide-icon>
  </button> 
    <button class="add-btn" (click)="goToAjouterEntreprise()">
  <lucide-icon name="Plus"></lucide-icon>
</button>
  <button [class.active]="activeTab===TabEnum.Messages" (click)="setTab(TabEnum.Messages)">
    <lucide-icon name="MessageSquare"></lucide-icon>
  </button> 
  <button [class.active]="activeTab===TabEnum.Profil" (click)="setTab(TabEnum.Profil)">
    <lucide-icon name="User"></lucide-icon>
  </button> 
</div>